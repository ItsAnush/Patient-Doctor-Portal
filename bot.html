<!DOCTYPE html>
<html>
  <head>
    <title>MediSearch Bot</title>
    <style>
      /* Global Styles */
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f0f0f0;
      }

      /* Chat Container */
      .chat-container {
        max-width: 400px;
        margin: 0 auto;
        background-color: #fff;
        box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        overflow: hidden;
      }

      /* Chat Header */
      .chat-header {
        background-color: #007bff;
        color: #fff;
        padding: 10px;
        text-align: center;
        font-weight: bold;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
      }

      /* Chat Messages */
      .chat-messages {
        padding: 10px;
        max-height: 300px;
        overflow-y: auto;
      }

      /* User Message */
      .user-message {
        text-align: right;
        margin-bottom: 10px;
      }

      /* Bot Message */
      .bot-message {
        text-align: left;
        margin-bottom: 10px;
        background-color: #e6e6e6;
        padding: 10px;
        border-radius: 5px;
      }

      /* Typing Animation */
      .typing-animation {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }

      .typing-animation::after {
        content: "";
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #007bff;
        margin-left: 10px;
        animation: typing 1s infinite;
      }

      @keyframes typing {
        0% {
          transform: scale(0.6);
        }
        50% {
          transform: scale(1);
        }
        100% {
          transform: scale(0.6);
        }
      }

      /* Chat Input */
      .chat-input {
        display: flex;
        align-items: center;
        background-color: #f0f0f0;
        padding: 10px;
        border-bottom-left-radius: 10px;
        border-bottom-right-radius: 10px;
      }

      #query {
        flex-grow: 1;
        padding: 8px;
        border: none;
        border-radius: 5px;
        outline: none;
      }

      #search-button {
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        padding: 8px 16px;
        cursor: pointer;
        outline: none;
      }

      #search-button:hover {
        background-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <div class="chat-header">MediSearch Bot</div>
      <div class="chat-messages" id="response-container">
        <!-- Typing animation will be displayed here -->
      </div>
      <div class="chat-input">
        <input
          type="text"
          id="query"
          name="query"
          placeholder="Enter your query..."
          required
        />
        <button type="button" id="search-button">Send</button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const queryInput = document.getElementById("query");
        const searchButton = document.getElementById("search-button");
        const responseContainer = document.getElementById("response-container");

        searchButton.addEventListener("click", function () {
          const query = queryInput.value;

          // Create a new message element for the user
          const userMessage = document.createElement("div");
          userMessage.className = "user-message";
          userMessage.innerHTML = query;
          responseContainer.appendChild(userMessage);

          // Clear the input field
          queryInput.value = "";

          // Simulate typing animation
          const typingAnimation = document.createElement("div");
          typingAnimation.className = "typing-animation";
          responseContainer.appendChild(typingAnimation);

          // Scroll to the bottom of the messages
          responseContainer.scrollTop = responseContainer.scrollHeight;

          // Make an AJAX request to bot.php
          const xhr = new XMLHttpRequest();
          xhr.open("POST", "bot.php", true);
          xhr.setRequestHeader(
            "Content-Type",
            "application/x-www-form-urlencoded"
          );

          xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
              if (xhr.status === 200) {
                try {
                  const response = JSON.parse(xhr.responseText);

                  // Debugging: Log the response to the console
                  console.log(response);

                  // Remove the typing animation
                  responseContainer.removeChild(typingAnimation);

                  // Display only the first data item from the bot's response
                  if (response.text && response.text[0]) {
                    const botResponse = document.createElement("div");
                    botResponse.className = "bot-message";
                    botResponse.textContent = response.text; // Display the first data item
                    responseContainer.appendChild(botResponse);
                  }

                  // Scroll to the bottom of the messages
                  responseContainer.scrollTop = responseContainer.scrollHeight;
                } catch (error) {
                  console.error("Error parsing JSON response:", error);
                }
              } else {
                console.error("HTTP request error. Status code:", xhr.status);
              }
            }
          };

          // Send the query as a POST parameter
          xhr.send("query=" + encodeURIComponent(query));
        });
      });
    </script>
  </body>
</html>
